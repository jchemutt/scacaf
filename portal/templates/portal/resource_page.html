{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block title %}{{ page.title }} | Resource{% endblock %}

{% block hero %}
<section class="relative overflow-hidden border-b border-slate-200/60 dark:border-slate-800/60">
  <div class="absolute inset-0">
    <div class="absolute inset-0 bg-gradient-to-b from-brand-50/70 to-white dark:from-slate-900 dark:to-slate-950"></div>
    <div class="absolute inset-0 [mask-image:radial-gradient(65%_60% at 50%_20%,black,transparent)] bg-[radial-gradient(1200px_600px_at_10%_-20%,rgba(99,102,241,.12),transparent)]"></div>
  </div>
  <div class="relative mx-auto max-w-7xl px-4 py-10">
    <div class="flex items-start gap-4">
      {% if page.thumbnail %}
        <div class="hidden sm:block w-24 h-24 rounded-xl overflow-hidden border border-slate-200 dark:border-slate-800 bg-white/50">
          {% image page.thumbnail fill-192x192 class="w-full h-full object-cover" %}
        </div>
      {% endif %}
      <div>
        <p class="text-xs inline-flex px-2 py-1 rounded-md bg-black/60 text-white backdrop-blur">{{ page.get_kind_display }}</p>
        <h1 class="mt-2 text-3xl md:text-4xl font-extrabold tracking-tight">{{ page.title }}</h1>
        <p class="mt-2 text-slate-600 dark:text-slate-300">{{ page.date|date:"M j, Y" }}</p>
      </div>
    </div>

    <!-- Meta chips -->
    <div class="mt-4 flex flex-wrap gap-2">
      {% for t in page.topics.all %}
        <span class="px-2.5 py-1 rounded-lg bg-slate-100 dark:bg-slate-800 text-xs">{{ t.name }}</span>
      {% endfor %}
      {% for a in page.audiences.all %}
        <span class="px-2.5 py-1 rounded-lg bg-slate-100 dark:bg-slate-800 text-xs">{{ a.name }}</span>
      {% endfor %}
      {% for r in page.regions.all %}
        <span class="px-2.5 py-1 rounded-lg bg-slate-100 dark:bg-slate-800 text-xs">{{ r.name }}</span>
      {% endfor %}
      {% for l in page.languages.all %}
        <span class="px-2.5 py-1 rounded-lg bg-brand-50 text-brand-700 dark:bg-slate-800 dark:text-brand-300 text-xs">{{ l.name }}</span>
      {% endfor %}
    </div>
  </div>
</section>
{% endblock %}

{% block content %}
<div class="grid lg:grid-cols-12 gap-8">
  <!-- Main -->
  <article class="lg:col-span-8">
    {% if page.abstract %}
      <div class="prose dark:prose-invert max-w-none">
        {{ page.abstract|richtext }}
      </div>
    {% endif %}

    {% if page.body %}
      <div class="mt-6 prose dark:prose-invert max-w-none">
        {{ page.body }}
      </div>
    {% endif %}
  </article>

  <!-- Sidebar -->
  <aside class="lg:col-span-4">
    <div class="rounded-2xl border border-slate-200 dark:border-slate-800 p-4">
      <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Downloads & Links</h2>

      {% if page.files.all %}
        <div class="mt-3 space-y-2">
          {% for f in page.files.all %}
            <a href="{{ f.document.url }}" class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-900 border border-slate-200/70 dark:border-slate-800">
              <svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="currentColor" d="M5 20h14v-2H5v2zM11 4v8.17l-3.59-3.58L6 10l6 6 6-6-1.41-1.41L13 12.17V4h-2z"/></svg>
              <span class="text-sm">{{ f.label|default:f.document.title }}</span>
            </a>
          {% endfor %}
        </div>
      {% endif %}

      {% if page.links.all %}
        <div class="mt-4 space-y-2">
          {% for l in page.links.all %}
            <a href="{{ l.url }}" target="_blank" rel="noopener" class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-900 border border-slate-200/70 dark:border-slate-800">
              <svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="currentColor" d="M14 3h7v7h-2V6.41l-9.29 9.3-1.42-1.42 9.3-9.29H14V3zM5 5h5V3H5a2 2 0 0 0-2 2v5h2V5zm0 14v-5H3v5a2 2 0 0 0 2 2h5v-2H5z"/></svg>
              <span class="text-sm">{{ l.label|default:l.url }}</span>
            </a>
          {% endfor %}
        </div>
      {% endif %}

      {% if not page.files.all and not page.links.all %}
        <p class="mt-3 text-sm text-slate-500">No attachments or links.</p>
      {% endif %}
    </div>

    {% if page.tags.all %}
      <div class="mt-4 rounded-2xl border border-slate-200 dark:border-slate-800 p-4">
        <h3 class="text-sm font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Tags</h3>
        <div class="mt-2 flex flex-wrap gap-2">
          {% for tag in page.tags.all %}
            <span class="px-2 py-1 rounded-lg bg-slate-100 dark:bg-slate-800 text-xs">#{{ tag }}</span>
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </aside>
</div>

<!-- Related -->
{% with related=page.related_by_topic %}
  {% if related %}
    <section class="mt-12">
      <h2 class="text-xl font-semibold flex items-center gap-2">
        <span>Related resources</span><span class="text-base">âœ¨</span>
      </h2>
      <div class="mt-4 grid sm:grid-cols-2 xl:grid-cols-3 gap-6">
        {% for r in related %}
          {% include "portal/includes/resource_card.html" with r=r %}
        {% endfor %}
      </div>
    </section>
  {% endif %}
{% endwith %}
{% endblock %}
